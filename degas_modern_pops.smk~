#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Apr  8 14:01:16 2020
@author: gsd818
"""
import pandas as pd
import csv
import os

configfile: "config.yaml"

PCA_K = range(1,7)
SET=['eur','gbr']

rule all:
    input:
        expand("1000genomes/pca/plots/{set}.pcadapt.screeplot.pdf", set=SET)


rule get_plink:
    input:
        vcf="1000genomes/1000g.annot.vcf.gz",
        ind="1000genomes/{set}.txt"
    output:
        expand("1000genomes/plink/{set}.{format}", format=['bed','bim','fam'],allow_missing=True)
    shell:
        "plink --vcf {input.vcf} --maf 0.05 --keep {input.ind} --make-bed --out 1000genomes/plink/{wildcards.set}"


rule run_pcadapt:
    input:
        "1000genomes/plink/{set}.bed"
    output:
        expand("1000genomes/pca/{set}-k{k}.pcadapt", k=PCA_K, allow_missing=True),
        "1000genomes/pca/plots/{set}.pcadapt.screeplot.pdf"
    params:
        min_k=min(PCA_K),
        max_k=max(PCA_K)
    shell:
        """
        Rscript scripts/pca_k_1000genomes.R {input} {params.min_k} {params.max_k} {wildcards.set}
        """

#rule corr_degas:
# todo :
# 1. Rscripts scripts/corr_pearson_degas.R
# 2. Rscripts scripts/degas_rand_corr.R	
# 3. Rscript scripts/pcadapt_plot_1000g.R : plot PCA coloured by popid
